MP3vec : A Reusable Machine-Constructed Feature Representation for Protein Sequences
======

Multi-Purpose Protein Prediction Vectors are generated by training a Deep Neural Network on a source problem (secondary structure prediction) and extracting the outputs of the intermediate layers. These vectors are transferable representations that can be used as baseline features across a wide range of target tasks involving sequence to sequence learning. This repository contains software tools to generate MP3 vectors for a dataset of given proteins.

# Package Overview

The MP3vec python module has a core MP3Model class that wraps the trained model with a couple of utility functions to read and process input PSSM files. This model returns a (L,640) dimensional vector where L is the length of the protein sequence. For those users who wish to generate MP3vecs for PSSM files without using the python module, there is a command line utility script to generate vectors for a list of PSSM files. Since the MP3vec generation requires PSSM files, another command line utility has been provided to generate them from a single FASTA file of sequences using PSI-BLAST.

This package has been tested on both Ubuntu 16.04 and Windows 10 and is fully compatible with Python 2.7x and 3.x as well. Since the backend model has been created using TensorFlow, it can be accelerated on a GPU. However, the current install script only installs the CPU version of Tensorflow. Please note that if you wish to generate your own PSSMs using PSI-BLAST, you will need to install the NCBI BLAST+ software suite and download the Uniref90 dataset.

# Installation on Linux

You can download the MP3vec package as a zip file from https://github.com/sanketx/MP3vec/archive/master.zip. Alternatively, you can clone the file using git from https://github.com/sanketx/MP3vec.git

```console
sanket@GPU:~$ mkdir mp3_project
sanket@GPU:~$ cd mp3_project/
sanket@GPU:~/mp3_project$ git clone https://github.com/sanketx/MP3vec.git
Cloning into 'MP3vec'...
remote: Counting objects: 14, done.
remote: Compressing objects: 100% (11/11), done.
remote: Total 14 (delta 1), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (14/14), done.
Checking connectivity... done.
sanket@GPU:~/mp3_project$ ls MP3vec/
MANIFEST.in  mp3vec  README.md  setup.py
sanket@GPU:~/mp3_project$
```

It is recommended that you use a [virtual environment](https://virtualenv.pypa.io/en/stable/) for the installation of this package. This creates a separate environment making it easier to manage packages and their dependencies. You will need [pip](https://pip.pypa.io/en/stable/installing/) to install it, although it is automatically available in most cases. If you don't have it, follow the instructions at the link above. Once the environment is installed, it needs to be activated.

```console
sanket@GPU:~/mp3_project$ pip install virtualenv
sanket@GPU:~/mp3_project$ virtualenv -p /usr/bin/python2.7 mp3env
Running virtualenv with interpreter /usr/bin/python2.7
New python executable in /home/sanket/mp3_project/mp3env/bin/python2.7
Also creating executable in /home/sanket/mp3_project/mp3env/bin/python
Installing setuptools, pip, wheel...done.
sanket@GPU:~/mp3_project$ source mp3env/bin/activate
(mp3env) sanket@GPU:~/mp3_project$
```
Now we can install the MP3vec package along with its dependencies in the virtual environment that we have just created.
```console
(mp3env) sanket@GPU:~/mp3_project$ pip install MP3vec/.
Processing /home/sanket/mp3_project/MP3vec
Collecting tensorflow>=1.8.0 (from mp3vec==0.0.1)
...(text ommited)
Successfully installed absl-py-0.4.0 astor-0.7.1 backports.weakref-1.0.post1 biopython-1.72 enum34-1.1.6 funcsigs-1.0.2 futures-3.2.0 gast-0.2.0 grpcio-1.14.1 h5py-2.8.0 keras-2.2.2 keras-applications-1.0.4 keras-preprocessing-1.0.2 markdown-2.6.11 mock-2.0.0 mp3vec-0.0.1 numpy-1.14.5 pbr-4.2.0 protobuf-3.6.1 pyyaml-3.13 scipy-1.1.0 setuptools-39.1.0 six-1.11.0 tensorboard-1.10.0 tensorflow-1.10.0 termcolor-1.1.0 werkzeug-0.14.1
(mp3env) sanket@GPU:~/mp3_project$
```
You can test the install by opening a python shell and importing the module

```console
(mp3env) sanket@GPU:~/mp3_project$ python
Python 2.7.12 (default, Dec  4 2017, 14:50:18) 
[GCC 5.4.0 20160609] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import mp3vec
Using TensorFlow backend.
>>> mp3vec.__version__
'0.0.1'
```
The package has now been successfully installed along with the utility scripts.

# Installation on Windows
To be filled

# Usage Instructions

## Example Script For Generating MP3 vectors
The mp3vec module has a core MP3Model class. The pretrained model provided with this package is used by default but you can specify a custom model by specifying the model file in the class constructor. A utility function "encode_file" is provided in order to read a PSSM file and convert it into a numpy array which can then be fed as input to the model. Note that this function automatically reads the protein sequence from the file and converts it to a one-hot vector form. The function returns this sequence along with the protein matrix (one-hot vector + PSSM vec). The model's vectorize function can then be used to convert this protein matrix into the MP3 vector.

```python
from mp3vec import *
model = MP3Model()
seq, protein_matrix = encode_file("PROT2.pssm")
vec = model.vectorize(protein_matrix)
```
